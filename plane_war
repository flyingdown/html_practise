<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript">
	function init() {
		/* 定义宽和高 */
		var WIDTH=480, HEIGHT=620;
		/* 定义状态 */
		var START = 0;
		var STARTING = 1;
		var RUNNING = 2;
		var PAUSE = 3;
		var GAMEOVER = 4;
		/* 初始状态 */
		var state = START;

		var bg = new Image();
		bg.src = "img/background.png";

		var copy_right = new Image();
		copy_right.src = "img/shoot_copyright.png"

		var canvas = document.querySelector ( "canvas");
		var ctx = canvas.getContext ('2d');

		/* 配置对象 */
		var load_config = [];
		for ( var i = 0; i < 4; ++i )
		{
			load_config[i] = new Image();
			load_config[i].src = "img/game_loading"+(i+1)+".png";
		}

		var LOADING = {
			frames : load_config,
			width : 186,
			height : 38,
			x : 0,
			y : HEIGHT - 38,
			speed : 10
		}

		var SKY = {
			image : bg, 
			width:480,
			height : 620,
			speed : 20
		}

		/* 逻辑对象 */
		var sky = new Sky(SKY);
		var loader = new loading ( LOADING );


		/* 为canvas添加事件 */
		canvas.onclick = function () {
			if ( state == START )
			{
				state = STARTING;
			}
		}

		/* 游戏加载动画 */
		function loading ( config ) {
			this.speed = 1000 / config.speed;
			this.last_move_time = new Date().getTime();
			this.frame_index = 0;
			/* 更换laoding图像 */
			this.step = function () {
				if ( new Date().getTime() - this.last_move_time < this.speed )
					return;

				this.frame = config.frames[this.frame_index++];
				// console.log ( this.frame_index );
				if ( this.frame_index >= 4 )
				{
					state = RUNNING;
				}

				this.last_move_time = new Date().getTime();
			}

			this.paint = function (ctx) {
				ctx.drawImage ( this.frame, config.x, config.y );
			}
		}

		/* 背景模版 */
		function Sky ( config ) {
			/* 数据 */ 
			this.bg = config.image;
			this.width = config.width;
			this.height = config.height;
			this.speed = 1000 / config.speed;

			this.x1 = this.x2 = 0;
			this.y1 = -1*HEIGHT;
			this.y2 = 0;

			this.last_move_time = new Date().getTime();
			/* 天空移动 */
			this.step = function (){
				if ( new Date().getTime() - this.last_move_time < this.speed )
					return;
				this.y1 = ( this.y1 >= HEIGHT ? -853 : ++this.y1 );
				this.y2 = ( this.y2 >= HEIGHT ? -853 : ++this.y2 );
				this.last_move_time = new Date().getTime();
			}
			/* 绘制天空 */
			this.paint = function ( ctx ) {
				ctx.drawImage ( this.bg, this.x1, this.y1);
				ctx.drawImage ( this.bg, this.x2, this.y2);
			}


		}

		setInterval ( function () {
			switch ( state )
			{
				case START :
					// 游戏背景
					sky.step();
					sky.paint(ctx);
					// 版权绘制
					var copy_right_x = (WIDTH-copy_right.naturalWidth)/2;
					var copy_right_y = (HEIGHT-copy_right.naturalHeight)/2;

		console.log (copy_right_x + ":" + copy_right_y);
					ctx.drawImage(copy_right, copy_right_x, copy_right_y);
					break;
				case STARTING :
					// 游戏背景
					sky.step();
					sky.paint(ctx);
					loader.step();
					loader.paint(ctx);
					break;
				case RUNNING :
					// 游戏背景
					sky.step();
					sky.paint(ctx);
					break;
				case PAUSE :
					// 游戏背景
					sky.step();
					sky.paint(ctx);
					break;
				case GAMEOVER :
					// 游戏背景
					sky.step();
					sky.paint(ctx);
					break;

			}
		}, 10);
	}

	window.addEventListener("load",init,false);
	</script>
</head>
<body>
<div style="width : 480px; height : 620px; margin: 0 auto">
<canvas width = "480" height = "620" >
	
</canvas>
</div>
</body>
</html>
